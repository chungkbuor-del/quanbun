<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Quán Chung</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f1f2f6; padding: 15px; font-family: sans-serif; }
        .item-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: none; }
        .btn-order { background: #ff4757; color: white; border-radius: 20px; padding: 5px 20px; font-weight: bold; border: none; }
    </style>
</head>
<body>
    <div class="container text-center">
        <h2 class="fw-bold text-danger mt-3">QUÁN CỦA CHUNG</h2>
        <p class="badge bg-secondary fs-6">Đang ngồi bàn: <span id="label-ban">...</span></p>
        <div id="danh-sach-menu" class="mt-4 text-start">Đang tải món...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCOasks_plua7yYBVgXIN3dKNIBS3WhO3Y",
            authDomain: "quanbun-6cf3b.firebaseapp.com",
            projectId: "quanbun-6cf3b",
            storageBucket: "quanbun-6cf3b.firebasestorage.app",
            messagingSenderId: "553498423375",
            appId: "1:553498423375:web:8c1ecdc1b3bd14651e7a3a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const table = new URLSearchParams(window.location.search).get('table') || "Chưa rõ";
        document.getElementById('label-ban').innerText = table;

        async function loadMenu() {
            const querySnapshot = await getDocs(collection(db, "MENU"));
            const container = document.getElementById('danh-sach-menu');
            container.innerHTML = "";
            querySnapshot.forEach((doc) => {
                const item = doc.data();
                // LƯU Ý: Phải viết đúng 'NAME' và 'THÀNH TIỀN' như trong Database
                const tenMon = item.NAME || "Không có tên";
                const giaMon = item['THÀNH TIỀN'] || 0;

                container.innerHTML += `
                    <div class="item-card d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-bold fs-5">${tenMon}</div>
                            <div class="text-danger fw-bold">${Number(giaMon).toLocaleString()}đ</div>
                        </div>
                        <button class="btn-order" onclick="datMon('${tenMon}', ${giaMon})">GỌI MÓN</button>
                    </div>`;
            });
        }

        window.datMon = async (name, price) => {
            if(confirm(`Bạn muốn gọi món: ${name}?`)) {
                try {
                    await addDoc(collection(db, "orders"), {
                        ban: table,
                        tenMon: name,
                        gia: price,
                        thoiGian: serverTimestamp()
                    });
                    alert("Đã gửi đơn thành công!");
                } catch (e) { alert("Lỗi gửi đơn: " + e.message); }
            }
        };
        loadMenu();
    </script>
</body>
</html>